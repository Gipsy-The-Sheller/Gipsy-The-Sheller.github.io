<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARAGORN - tRNA/mtRNA/tmRNA åŸºå› æ£€æµ‹å·¥å…·</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* ARAGORN ç‰¹å®šæ ·å¼ */
        .aragorn-container {
            background-color: var(--gbif-white);
            border-radius: 8px;
            box-shadow: var(--gbif-shadow);
            padding: 30px;
        }

        .upload-area {
            border: 2px dashed var(--gbif-medium-gray);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background-color: var(--gbif-light-gray);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 25px;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--gbif-green);
            background-color: rgba(154, 184, 61, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--gbif-green);
            margin-bottom: 15px;
        }

        .upload-text {
            color: var(--gbif-text);
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .upload-hint {
            color: var(--gbif-dark-gray);
            font-size: 0.9em;
        }

        .options-section {
            margin-bottom: 25px;
        }

        .options-section h3 {
            color: var(--gbif-green);
            margin-bottom: 15px;
            font-size: 1.3rem;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--gbif-medium-gray);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .option-group {
            background-color: var(--gbif-light-gray);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--gbif-medium-gray);
        }

        .option-group h4 {
            color: var(--gbif-text);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            color: var(--gbif-text);
            font-size: 0.95rem;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            accent-color: var(--gbif-green);
            width: 18px;
            height: 18px;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            color: var(--gbif-text);
            font-size: 0.95rem;
        }

        .radio-group input[type="radio"] {
            margin-right: 10px;
            accent-color: var(--gbif-green);
            width: 18px;
            height: 18px;
        }

        .select-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gbif-medium-gray);
            border-radius: 4px;
            font-size: 0.95rem;
            background-color: var(--gbif-white);
            cursor: pointer;
        }

        .select-group select:focus {
            outline: none;
            border-color: var(--gbif-green);
            box-shadow: 0 0 0 2px rgba(154, 184, 61, 0.2);
        }

        .run-button {
            background-color: var(--gbif-green);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--gbif-shadow);
            font-weight: 600;
        }

        .run-button:hover:not(:disabled) {
            background-color: var(--gbif-dark-green);
            transform: translateY(-2px);
            box-shadow: var(--gbif-shadow-hover);
        }

        .run-button:disabled {
            background-color: var(--gbif-medium-gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .output-section {
            background-color: #1e1e1e;
            border-radius: 6px;
            padding: 20px;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            box-shadow: var(--gbif-shadow);
            position: relative;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }

        .output-title {
            color: #9acc3d;
            font-weight: bold;
            margin: 0;
        }

        .copy-button {
            background-color: var(--gbif-green);
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .copy-button:hover {
            background-color: var(--gbif-dark-green);
        }

        .status-bar {
            padding: 15px 20px;
            background-color: var(--gbif-light-gray);
            border-top: 1px solid var(--gbif-medium-gray);
            border-radius: 6px;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--gbif-medium-gray);
        }

        .status-indicator.ready {
            background-color: #4caf50;
        }

        .status-indicator.processing {
            background-color: #ff9800;
            animation: pulse 1s infinite;
        }

        .status-indicator.error {
            background-color: #f44336;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .file-info {
            color: var(--gbif-dark-gray);
            font-size: 0.9em;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
            gap: 20px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--gbif-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 1.2em;
        }

        .aragorn-header {
            margin-bottom: 30px;
        }

        .aragorn-header h2 {
            color: var(--gbif-green);
            font-size: 2rem;
            margin: 0 0 10px 0;
        }

        .aragorn-header p {
            color: var(--gbif-text);
            font-size: 1rem;
            margin: 0;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <h1>ARAGORN WebAssembly</h1>
            <nav class="navigation">
                <a href="index.html" class="navigation-link">åˆ†ç±»å­¦æ•°æ®åº“</a>
                <a href="tools.html" class="navigation-link">å·¥å…·é›†</a>
                <a href="aragorn.html" class="navigation-link active">ARAGORN</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div id="app">
                <div class="aragorn-container">
                    <div class="aragorn-header">
                        <h2>ARAGORN - tRNA/mtRNA/tmRNA åŸºå› æ£€æµ‹å·¥å…·</h2>
                        <p>æ£€æµ‹ tRNAã€mtRNA å’Œ tmRNA åŸºå›  | Reference: Laslett, D. and Canback, B. (2004) Nucleic Acids Research, 32;11-16</p>
                    </div>

                    <div class="upload-area" 
                         id="uploadArea" 
                         :class="{ dragover: isDragover }"
                         @dragover.prevent="isDragover = true"
                         @dragleave.prevent="isDragover = false"
                         @drop.prevent="handleDrop"
                         @click="$refs.fileInput.click()">
                        <input type="file" ref="fileInput" accept=".fasta,.fa,.gb,.txt" @change="handleFileSelect" style="display: none;">
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„</div>
                        <div class="upload-hint">æ”¯æŒ .fasta, .fa, .gb, .txt æ ¼å¼</div>
                    </div>

                    <div class="options-section">
                        <h3>å‚æ•°é€‰é¡¹</h3>
                        <div class="options-grid">
                            <div class="option-group">
                                <h4>åŸºå› ç±»å‹</h4>
                                <div class="checkbox-group">
                                    <label>
                                        <input type="checkbox" v-model="options.searchTRNA" checked>
                                        æœç´¢ tRNA åŸºå› ï¼ˆé»˜è®¤ï¼‰
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.searchTMRNA">
                                        æœç´¢ tmRNA åŸºå› 
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.searchMT">
                                        æœç´¢åç”ŸåŠ¨ç‰©çº¿ç²’ä½“ tRNA
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.searchMTMAM">
                                        æœç´¢å“ºä¹³åŠ¨ç‰©çº¿ç²’ä½“ tRNA
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.searchMTX">
                                        åç”ŸåŠ¨ç‰©çº¿ç²’ä½“ï¼ˆä½è¯„åˆ†ä¸æŠ¥å‘Šï¼‰
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.searchMTD">
                                        æŠ¥å‘Šåé“¾é‡å åŸºå› 
                                    </label>
                                </div>
                            </div>

                            <div class="option-group">
                                <h4>æ‹“æ‰‘ç»“æ„</h4>
                                <div class="radio-group">
                                    <label>
                                        <input type="radio" v-model="options.topology" value="circular" checked>
                                        ç¯å½¢ï¼ˆé»˜è®¤ï¼‰
                                    </label>
                                    <label>
                                        <input type="radio" v-model="options.topology" value="linear">
                                        çº¿æ€§
                                    </label>
                                </div>
                            </div>

                            <div class="option-group">
                                <h4>æœç´¢é“¾</h4>
                                <div class="radio-group">
                                    <label>
                                        <input type="radio" v-model="options.strand" value="both" checked>
                                        åŒé“¾ï¼ˆé»˜è®¤ï¼‰
                                    </label>
                                    <label>
                                        <input type="radio" v-model="options.strand" value="sense">
                                        æ­£é“¾
                                    </label>
                                    <label>
                                        <input type="radio" v-model="options.strand" value="antisense">
                                        åé“¾
                                    </label>
                                </div>
                            </div>

                            <div class="option-group">
                                <h4>é—ä¼ å¯†ç è¡¨</h4>
                                <div class="select-group">
                                    <select v-model="options.geneticCode">
                                        <option value="">é»˜è®¤ï¼ˆæ ‡å‡†ï¼‰</option>
                                        <option value="-gcstd">æ ‡å‡†é—ä¼ å¯†ç </option>
                                        <option value="-gcmet">åç”ŸåŠ¨ç‰©çº¿ç²’ä½“</option>
                                        <option value="-gcvert">è„Šæ¤åŠ¨ç‰©çº¿ç²’ä½“</option>
                                        <option value="-gcinvert">æ— è„Šæ¤åŠ¨ç‰©çº¿ç²’ä½“</option>
                                        <option value="-gcyeast">é…µæ¯çº¿ç²’ä½“</option>
                                        <option value="-gcprot">åŸç”ŸåŠ¨ç‰©çº¿ç²’ä½“</option>
                                        <option value="-gcciliate">çº¤æ¯›è™«</option>
                                        <option value="-gcflatworm">æ‰å½¢åŠ¨ç‰©çº¿ç²’ä½“</option>
                                        <option value="-gceuplot">Euplotid</option>
                                        <option value="-gcbact">ç»†èŒ/æ¤ç‰©å¶ç»¿ä½“</option>
                                        <option value="-gcaltyeast">æ›¿ä»£é…µæ¯</option>
                                        <option value="-gcascid">æµ·é˜çº¿ç²’ä½“</option>
                                        <option value="-gcaltflat">æ›¿ä»£æ‰å½¢åŠ¨ç‰©çº¿ç²’ä½“</option>
                                        <option value="-gcblep">Blepharisma</option>
                                        <option value="-gcchloroph">ç»¿è—»çº¿ç²’ä½“</option>
                                        <option value="-gctrem">å¸è™«çº¿ç²’ä½“</option>
                                        <option value="-gcscen">Scenedesmus obliquus</option>
                                        <option value="-gcthraust">Thraustochytrium</option>
                                        <option value="-gcptero">Pterobranchia</option>
                                        <option value="-gcgrac">Gracilibacteria</option>
                                        <option value="-gcpach">Pachysolen</option>
                                        <option value="-gckary">Karyorelict</option>
                                        <option value="-gccond">Condylostoma</option>
                                        <option value="-gcmeso">Mesodinium</option>
                                        <option value="-gcperi">Peritrich</option>
                                        <option value="-gcblast">Blastocrithidia</option>
                                        <option value="-gcceph">Cephalodiscidae</option>
                                    </select>
                                </div>
                            </div>

                            <div class="option-group">
                                <h4>å†…å«å­æ£€æµ‹</h4>
                                <div class="checkbox-group">
                                    <label>
                                        <input type="checkbox" v-model="options.searchIntron">
                                        æœç´¢åŒ…å«å†…å«å­çš„ tRNA
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.intronOverlap">
                                        å…è®¸é•¿å†…å«å­é‡å çŸ­ tRNA
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.fixedIntron">
                                        å›ºå®šå†…å«å­åœ¨ C-loop 37-38
                                    </label>
                                </div>
                            </div>

                            <div class="option-group">
                                <h4>æ£€æµ‹é€‰é¡¹</h4>
                                <div class="checkbox-group">
                                    <label>
                                        <input type="checkbox" v-model="options.tvloop" checked>
                                        æœç´¢ TV æ›¿æ¢ç¯ tRNA
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.cloop7">
                                        ä»…æœç´¢ 7 ç¢±åŸº C ç¯
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.strictSpacer">
                                        ä¸¥æ ¼é—´éš”åŒºè§„åˆ™
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.showScore">
                                        æ˜¾ç¤ºè¯„åˆ†
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.lowerThreshold">
                                        é™ä½è¯„åˆ†é˜ˆå€¼åˆ° 95%
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.reportPseudo">
                                        æ ‡è®°å¯èƒ½å‡åŸºå› 
                                    </label>
                                </div>
                            </div>

                            <div class="option-group">
                                <h4>è¾“å‡ºæ ¼å¼</h4>
                                <div class="checkbox-group">
                                    <label>
                                        <input type="checkbox" v-model="options.verbose">
                                        è¯¦ç»†æ¨¡å¼
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.showSeq">
                                        æ˜¾ç¤ºåºåˆ—
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.showStructure">
                                        æ˜¾ç¤ºäºŒçº§ç»“æ„
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.svg">
                                        ç”Ÿæˆ SVG å›¾åƒ
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.fasta">
                                        FASTA æ ¼å¼
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.fastaOnly">
                                        ä»… FASTA æ ¼å¼
                                    </label>
                                </div>
                            </div>

                            <div class="option-group">
                                <h4>å…¶ä»–é€‰é¡¹</h4>
                                <div class="checkbox-group">
                                    <label>
                                        <input type="checkbox" v-model="options.batch">
                                        æ‰¹å¤„ç†æ¨¡å¼
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.batchAdvanced">
                                        æ‰¹å¤„ç†æ¨¡å¼ï¼ˆé«˜çº§ï¼‰
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.repeatName">
                                        é‡å¤åºåˆ—åç§°
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.showAcceptor">
                                        æ˜¾ç¤ºæ°¨é…°åŸºå—ä½“
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.showTRNADomain">
                                        æ˜¾ç¤º tmRNA tRNA ç»“æ„åŸŸ
                                    </label>
                                    <label>
                                        <input type="checkbox" v-model="options.config">
                                        æ˜¾ç¤ºé…ç½®ä¿¡æ¯
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-bottom: 25px;">
                        <button class="run-button" 
                                @click="runARAGORN" 
                                :disabled="!selectedFile || !moduleLoaded || isProcessing">
                            {{ isProcessing ? 'å¤„ç†ä¸­...' : 'è¿è¡Œ ARAGORN' }}
                        </button>
                    </div>

                    <div class="output-section" id="output">
                        <div class="output-header">
                            <h3 class="output-title">è¾“å‡ºç»“æœ</h3>
                            <button class="copy-button" @click="copyOutput" v-if="output">
                                å¤åˆ¶ç»“æœ
                            </button>
                        </div>
                        <pre>{{ output || 'ç­‰å¾…è¾“å…¥...' }}</pre>
                    </div>

                    <div class="status-bar">
                        <div class="status">
                            <div class="status-indicator" :class="statusClass"></div>
                            <span>{{ statusText || 'ç­‰å¾…è¾“å…¥...' }}</span>
                        </div>
                        <div class="file-info">
                            {{ selectedFile ? `${selectedFile.name} (${formatFileSize(selectedFile.size)})` : 'æœªé€‰æ‹©æ–‡ä»¶' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 å¾å¿—æ° | ARAGORN WebAssembly v1.2.41</p>
        </div>
    </footer>

    <div v-if="isProcessing" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">æ­£åœ¨å¤„ç†...</div>
    </div>

    <!-- åŠ è½½ ARAGORN WebAssembly æ¨¡å— -->
    <script>
        var Module = {
            noInitialRun: true,
            print: function(text) {
                console.log(text);
                if (window.app) {
                    window.app.appendOutput(text);
                }
            },
            printErr: function(text) {
                console.error(text);
                if (window.app) {
                    window.app.appendOutput(text);
                }
            },
            onRuntimeInitialized: function() {
                console.log('WASM æ¨¡å—åŠ è½½å®Œæˆ');
                if (window.app) {
                    window.app.moduleLoaded = true;
                }
            },
            onAbort: function(what) {
                console.error('WASM æ‰§è¡Œä¸­æ­¢:', what);
                if (window.app) {
                    window.app.statusClass = 'error';
                    window.app.statusText = 'WASM æ‰§è¡Œä¸­æ­¢';
                    window.app.output = 'æ‰§è¡Œä¸­æ­¢: ' + what;
                }
            }
        };
    </script>
    <script src="aragorn.js"></script>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    selectedFile: null,
                    isDragover: false,
                    output: '',
                    moduleLoaded: false,
                    isProcessing: false,
                    statusText: '',
                    statusClass: '',
                    options: {
                        searchTRNA: true,
                        searchTMRNA: false,
                        searchMT: false,
                        searchMTMAM: false,
                        searchMTX: false,
                        searchMTD: false,
                        topology: 'circular',
                        strand: 'both',
                        geneticCode: '',
                        searchIntron: false,
                        intronOverlap: false,
                        fixedIntron: false,
                        tvloop: true,
                        cloop7: false,
                        strictSpacer: false,
                        showScore: false,
                        lowerThreshold: false,
                        reportPseudo: false,
                        verbose: false,
                        showSeq: false,
                        showStructure: false,
                        svg: false,
                        fasta: false,
                        fastaOnly: false,
                        batch: false,
                        batchAdvanced: false,
                        repeatName: false,
                        showAcceptor: false,
                        showTRNADomain: false,
                        config: false
                    }
                }
            },
            computed: {
                statusClass() {
                    if (!this.moduleLoaded) return '';
                    if (this.isProcessing) return 'processing';
                    return 'ready';
                }
            },
            methods: {
                handleFileSelect(event) {
                    const files = event.target.files;
                    if (files.length > 0) {
                        this.selectedFile = files[0];
                        this.output = 'ç­‰å¾…è¾“å…¥...' + '\nç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„';
                    }
                },
                handleDrop(event) {
                    this.isDragover = false;
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        this.selectedFile = files[0];
                        this.output = 'ç­‰å¾…è¾“å…¥...' + '\nç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„';
                    }
                },
                formatFileSize(bytes) {
                    if (bytes < 1024) return bytes + ' B';
                    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
                    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
                },
                appendOutput(text) {
                    if (this.output === 'ç­‰å¾…è¾“å…¥...' || this.output === 'ç­‰å¾…è¾“å…¥...\nç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„') {
                        this.output = '';
                    }
                    this.output += text + '\n';
                },
                buildArguments() {
                    const args = [];

                    // åŸºå› ç±»å‹
                    const { searchTRNA, searchTMRNA, searchMT, searchMTMAM, searchMTX, searchMTD } = this.options;
                    let geneTypeSet = false;

                    if (searchMTMAM) {
                        args.push('-mtmam');
                        geneTypeSet = true;
                    } else if (searchMTX) {
                        args.push('-mtx');
                        geneTypeSet = true;
                    } else if (searchMT) {
                        args.push('-mt');
                        geneTypeSet = true;
                    }

                    if (!geneTypeSet) {
                        if (searchTRNA && searchTMRNA) {
                            // ä¸¤è€…éƒ½é€‰ä¸­ï¼Œä¸æ·»åŠ å‚æ•°ï¼ˆé»˜è®¤æœç´¢æ‰€æœ‰ï¼‰
                        } else if (searchTRNA) {
                            args.push('-t');
                            geneTypeSet = true;
                        } else if (searchTMRNA) {
                            args.push('-m');
                            geneTypeSet = true;
                        } else {
                            // éƒ½æ²¡é€‰ä¸­ï¼Œæœç´¢ tRNA
                            args.push('-t');
                            geneTypeSet = true;
                        }
                    } else {
                        if (searchTMRNA) args.push('-m');
                        if (searchTRNA) args.push('-t');
                    }

                    if (searchMTD) args.push('-mtd');

                    // æ‹“æ‰‘ç»“æ„
                    args.push(this.options.topology === 'linear' ? '-l' : '-c');

                    // æœç´¢é“¾
                    const strand = this.options.strand;
                    if (strand === 'sense') args.push('-s');
                    else if (strand === 'antisense') args.push('-sc');
                    else args.push('-d');

                    // é—ä¼ å¯†ç è¡¨
                    if (this.options.geneticCode) args.push(this.options.geneticCode);

                    // å†…å«å­æ£€æµ‹
                    const { searchIntron, intronOverlap, fixedIntron } = this.options;
                    if (searchIntron) {
                        if (fixedIntron) {
                            args.push(intronOverlap ? '-ifo' : '-if');
                        } else {
                            args.push(intronOverlap ? '-io' : '-i');
                        }
                    }

                    // æ£€æµ‹é€‰é¡¹
                    if (!this.options.tvloop) args.push('-tv');
                    if (this.options.cloop7) args.push('-c7');
                    if (this.options.strictSpacer) args.push('-ss');
                    if (this.options.showScore) args.push('-e');
                    if (this.options.lowerThreshold) args.push('-ps');
                    if (this.options.reportPseudo) args.push('-rp');

                    // è¾“å‡ºæ ¼å¼
                    if (this.options.verbose) args.push('-v');
                    if (this.options.showSeq) args.push('-seq');
                    if (this.options.showStructure) args.push('-br');
                    if (this.options.svg) args.push('-svg');
                    if (this.options.fasta) args.push('-fasta');
                    if (this.options.fastaOnly) args.push('-fo');

                    // å…¶ä»–é€‰é¡¹
                    if (this.options.batch) args.push('-w');
                    if (this.options.batchAdvanced) args.push('-wa');
                    if (this.options.repeatName) args.push('-rn');
                    if (this.options.showAcceptor) args.push('-aa');
                    if (this.options.showTRNADomain) args.push('-a');
                    if (!this.options.config) args.push('-q');

                    return args;
                },
                async runARAGORN() {
                    if (!this.selectedFile || !this.moduleLoaded || !Module) return;

                    this.isProcessing = true;
                    this.output = '';
                    this.statusText = 'æ­£åœ¨åˆ†æåºåˆ—...';

                    try {
                        if (typeof FS === 'undefined' || !FS.initialized) {
                            throw new Error('æ–‡ä»¶ç³»ç»Ÿæœªåˆå§‹åŒ–');
                        }

                        const fileContent = await this.readFile(this.selectedFile);
                        const fileName = 'input.fasta';
                        FS.writeFile(fileName, fileContent);

                        const args = [...this.buildArguments(), fileName];

                        Module.callMain(args);

                        this.statusText = 'åˆ†æå®Œæˆ';
                        this.statusClass = 'ready';

                    } catch (error) {
                        this.output = 'é”™è¯¯: ' + error.message + '\n\n' + (error.stack || '');
                        this.statusText = 'å‘ç”Ÿé”™è¯¯';
                        this.statusClass = 'error';
                        console.error('è¿è¡Œé”™è¯¯:', error);
                    } finally {
                        this.isProcessing = false;
                    }
                },
                readFile(file) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve(e.target.result);
                        reader.onerror = (e) => reject();
                        reader.readAsText(file);
                    });
                },
                copyOutput() {
                    navigator.clipboard.writeText(this.output);
                    alert('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }
            },
            mounted() {
                window.app = this;
                this.statusText = 'ç­‰å¾…è¾“å…¥...';
            }
        }).mount('#app');
    </script>
</body>
</html>